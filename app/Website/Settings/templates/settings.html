{% extends "base.html" %}
{% block head %}
    {{super()}}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='settings.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='button.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='modal.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='toast.css') }}">
{%  endblock %}
{% block content %}

<div class="container">
    <button class="btn btn-primary" id="successToastBtn" onclick="createToast('Success', 'toast-success')">Show Success Toast</button>
    <button class="btn btn-primary" id="successToastBtn" onclick="createToast('Fail', 'toast-fail')">Show Fail Toast</button>
    <button class="btn btn-primary" href="{{ url_for('settings.calendarTest') }}">Calendar Test</button>
    <div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
        <img src="{{url_for('static', filename='images/icons/check1.svg')}}" class="rounded me-2" alt="...">
        <strong class="me-auto">System</strong>
        <small>Now</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
        
        </div>
    </div>
    </div>

    <div class="col">
        <div class="row" id="accountInfo">
            <h1 class="heading1">Account</h1>
            <div class="col" id="username">
                <p class="heading2">Username</p>
                <p class="text2">John Doe</p>
            </div>
            <div class="col" id="userId">
                <p class="heading2">User ID</p>
                <p class="text2">12345</p>
            </div>
        </div>
        <h1 class="heading1">Settings</h1>
        <div class="row" id="settings">
            <form method="POST" action="{{url_for('settings.setFunction')}}">
                {{scoreForm.csrf_token(id='scoreForm_csrf_token')}}
                <div class="w-auto d-flex align-items-center">
                {% for subfield in scoreForm.function %}
                    {% if loop.index0 == 0 %}
                        
                            {{subfield(class_="form-check-input", type="radio")}}
                            <label class="btn btn-radio mb-0" for="{{subfield.id}}">{{subfield.label.text}}</label>
                            <button type="button" class="btn w-auto"
                                    data-bs-toggle="tooltip" data-bs-placement="top"
                                    data-bs-custom-class="custom-tooltip"
                                    data-bs-title="
                                    Priority increases exponentially as the
                                    deadline approaches 72 hours. Best for last minute work.">
                                <img src="{{ url_for('static', filename='images/icons/info.svg') }}">
                            </button>
                        
                    {% else %}
                            {{subfield(class_="form-check-input", type="radio")}}
                            <label class="btn btn-radio mb-0 " for="{{subfield.id}}">{{subfield.label.text}}</label>
                            <button type="button" class="btn w-auto"
                                    data-bs-toggle="tooltip" data-bs-placement="top"
                                    data-bs-custom-class="custom-tooltip"
                                    data-bs-title="
                                    Priority increases smoothly and continuously over 
                                    1 week (168 hours). Best for steady, consistent work. (Default)">
                                    <img src="{{ url_for('static', filename='images/icons/info.svg') }}">
                            </button>
                    {%endif%}
                {%endfor%}
                </div>
                {{scoreForm.submit(class_="btn btn-primary", id="submit1")}}
            </form>
        </div>
        <h1 class="heading1 mb-1 mt-1">Integrations</h1>
        <div class="row" id="integrations">
            <div>
                <button onclick="client.requestCode();">Authorize with Google</button>
            </div>

            <form method="POST" action="{{ url_for('settings.authGoogle', _external=True, _scheme='http') }}">
                {{tokenForm.csrf_token(id='tokenForm_csrf_token')}}
                <div class="row w-auto align-items-center">
                    <span class="pr-1 w-auto">Canvas Token</span>
                    {{tokenForm.token(class_="input w-25")}} 
                    {{tokenForm.submit(class_="d-none", id="submit2")}}
                    <button type="submit" class="btn btn-submit d-flex justify-content-center">
                        <img class="" src="{{ url_for('static', filename='images/icons/check1.svg')}}">
                    </button>
                </div>
            </form>
        </div>
        <div class="row mt-2" id="logout">
            <button class="btn btn-primary w-auto">
                <img src="{{ url_for('static', filename='images/icons/logout.svg') }}">
                Logout from Account
            </button>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="https://accounts.google.com/gsi/client"></script>
<script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    function createToast(message, type) {
        const toastLiveExample = document.getElementById('liveToast');
        toastLiveExample.setAttribute("class", `toast ${type}`);
    
        
        const toastBootstrap = bootstrap.Toast.getOrCreateInstance(toastLiveExample);
        const toastBody = toastLiveExample.querySelector('.toast-body');
        toastBody.innerHTML = message;
        toastBootstrap.show()
    }

    const client = google.accounts.oauth2.initCodeClient({
    client_id: '191762128708-5mo6v6td9hseta7244b9gjbubonssqhu.apps.googleusercontent.com',
    scope: 'https://www.googleapis.com/auth/calendar',
    ux_mode: 'popup',
    callback: (response) => {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', "http://localhost:5000/dashboard/settings/auth/google", true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        // Set custom header for CRSF
        xhr.setRequestHeader('X-Requested-With', 'XmlHttpRequest');
        xhr.onload = function() {
        console.log('Auth code response: ' + xhr.responseText);
        };
        xhr.send('code=' + response.code);
    },
    });

</script>
{%with messages = get_flashed_messages(with_categories=true)%}
    {%if messages%}
        {% for category, msg in messages %}
            {% if category == "success" %}
                <script>
                    createToast({{msg|tojson}}, "toast-success")
                </script>
            {%endif%}
        {%endfor%}
    {%endif%}
{%endwith%}
{% endblock %}


